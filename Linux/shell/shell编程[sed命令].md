# 1 命令介绍

sed：Stream Editor文本流编辑，sed是一个“非交互式的”面向字符流的编辑器。能同时处理多个文件多行的内容，可以不对原文件改动，把整个文件输入到屏幕,可以把只匹配到模式的内容输入到屏幕上。还可以对原文件改动，但是不会再屏幕上返回结果。

使用格式：

- `sed [option] 'sed command' filename`

- `sed [option] -f sed_script_filename filename`

# 2 选项

- -n 只打印模式匹配的行
- -e ：直接在命令行模式上进行sed动作编辑，此为缺省选项，可以指定多次，sed命令会把多次执行的结果都打印在标准输出
- -f ：将sed的动作写在一个文件内，用–f filename 执行filename内的sed动作
- -r ：支持扩展表达式
- -i ：直接修改文件内容

# 3 功能

## 3.1 打印文本指定的行

命令格式：

- `xp`，x是整数，大于等于1，打印第x行
- `x,yp`，打印从x到y的行
- `x,y!p`，打印从除了x到y的行

例如：`sed -n '1,2p' test.txt`，就会打印第一第二行，注意加上-n选项，否则会打印所有内容的同时，重复打印第一第二行

## 3.2 模式匹配

- `/pattern/p`，打印包含模式的行
- `/p1/{/p2/{/p3 ...pn/p} ... }}`，打印同时匹配p1，p2，p3  ... pn的行
- `/p1/{xp}`，在x行中查询包含p1的行
- `/p1/{x,yp}`，在从x到y行中查询包含p1的行
- `/p1/{x,y!p}`，在从除了x到y行中查询包含p1的行
- `x,/pattern/p`，打印从x行开始，到第一次匹配到pattern的所有行

## 3.3 包含正则的模式匹配

3.2中的pattern都可以替换成正则表达式，格式如下

| ^           | 锚点行首的符合条件的内容，用法格式"^pattern" |
| ----------- | -------------------------------------------- |
| $           | 锚点行首的符合条件的内容，用法格式"pattern$" |
| ^$          | 空白行                                       |
| .           | 匹配任意单个字符                             |
| *           | 匹配紧挨在前面的字符任意次(0,1,多次)         |
| .*          | 匹配任意长度的任意字符                       |
| \？         | 匹配紧挨在前面的字符0次或1次                 |
| \{m,n\}     | 匹配其前面的字符至少m次，至多n次             |
| \{m,\}      | 匹配其前面的字符至少m次                      |
| \{m\}       | 精确匹配前面的m次\{0,n\}:0到n次              |
| \<          | 锚点词首----相当于 \b，用法格式：\<pattern   |
| \>          | 锚点词尾，用法格式:\>pattern                 |
| \<pattern\> | 单词锚点                                     |
|             | 分组，用法格式：pattern，引用\1,\2           |
| []          | 匹配指定范围内的任意单个字符                 |
| [^]         | 匹配指定范围外的任意单个字符                 |
| [:digit:]   | 所有数字, 相当于0-9， [0-9]---> [[:digit:]]  |
| [:lower:]   | 所有的小写字母                               |
| [:upper:]   | 所有的大写字母                               |
| [:alpha:]   | 所有的字母                                   |
| [:alnum:]   | 相当于0-9a-zA-Z                              |
| [:space:]   | 空白字符                                     |
| [:punct:]   | 所有标点符号                                 |

除了p表示打印之外，sed还有其他的编辑命令，

| p          | 打印匹配行（和-n选项一起合用）                               |
| ---------- | ------------------------------------------------------------ |
| =          | 显示文件行号                                                 |
| a\         | 在定位行号后附加新文本信息                                   |
| i\         | 在定位行号后插入新文本信息                                   |
| d          | 删除定位行                                                   |
| c\         | 用新文本替换定位文本                                         |
| w filename | 写文本到一个文件，类似输出重定向 >                           |
| r filename | 从另一个文件中读文本，类似输入重定向 <                       |
| s          | 使用替换模式替换相应模式                                     |
| q          | 第一个模式匹配完成后退出或立即退出                           |
| l          | 显示与八进制ACSII代码等价的控制符                            |
| {}         | 在定位行执行的命令组，用分号隔开                             |
| n          | 从另一个文件中读文本下一行，并从下一条命令而不是第一条命令开始对其的处理 |
| N          | 在数据流中添加下一行以创建用于处理的多行组                   |
| g          | 将模式2粘贴到/pattern n/                                     |
| y          | 传送字符，替换单个字符                                       |

## 3.4 模式替换

格式：`sed -n '/s/p1/p2/g;/s/p3/p4/g;....p' filename`，

表示用p1模式替换p2模式，用p3模式替换p4模式，...... 最后p表示print，打印到标准输出，filename支持通配符